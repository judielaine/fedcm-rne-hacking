<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1446px" preserveAspectRatio="none" style="width:1575px;height:1446px;background:#FFFFFF;" version="1.1" viewBox="0 0 1575 1446" width="1575px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.4883" id="_title" style="stroke:none;stroke-width:1.0;" width="347" x="615.25" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="337" x="620.25" y="28.5352">Basic SAMLv2 Proxy Flow (including discovery)</text><rect fill="#D3D3D3" height="1397.2402" style="stroke:#181818;stroke-width:0.5;" width="168" x="26" y="43.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="92.5" y="56.0566">User</text><rect fill="#E0FFFF" height="1397.2402" style="stroke:#181818;stroke-width:0.5;" width="348.5" x="239.5" y="43.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="85" x="369.25" y="56.0566">research.org</text><rect fill="#FFFFFF" height="1178.7109" style="stroke:#181818;stroke-width:1.0;" width="10" x="563.5" y="199.5293"/><rect fill="#FFFFFF" height="733.7529" style="stroke:#181818;stroke-width:1.0;" width="10" x="910.5" y="341.7373"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="1181.5" y="453.3242"/><rect fill="#FFFFFF" height="346.3711" style="stroke:#181818;stroke-width:1.0;" width="10" x="1274.5" y="656.1875"/><rect fill="none" height="324.3711" style="stroke:#000000;stroke-width:1.5;" width="1558.5" x="10" y="671.1875"/><rect fill="none" height="118.2422" style="stroke:#000000;stroke-width:1.5;" width="1427.5" x="20" y="790.3848"/><rect fill="none" height="206.1289" style="stroke:#000000;stroke-width:1.5;" width="533" x="61" y="1165.1113"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="53" x2="53" y1="94.2871" y2="1406.2402"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="155" x2="155" y1="94.2871" y2="1406.2402"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="264.5" x2="264.5" y1="94.2871" y2="1406.2402"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="568" x2="568" y1="94.2871" y2="1406.2402"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="915.5" x2="915.5" y1="94.2871" y2="1406.2402"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1186" x2="1186" y1="94.2871" y2="1406.2402"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1279" x2="1279" y1="94.2871" y2="1406.2402"/><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="47" x="30" y="62.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="37" y="83.334">Alice</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="47" x="30" y="1405.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="37" y="1425.7754">Alice</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="121" y="62.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="128" y="83.334">Browser</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="121" y="1405.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="128" y="1425.7754">Browser</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="243.5" y="62.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="250.5" y="83.334">Wiki</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="42" x="243.5" y="1405.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="250.5" y="1425.7754">Wiki</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="31" x="553" y="62.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="17" x="560" y="83.334">RP</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="31" x="553" y="1405.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="17" x="560" y="1425.7754">RP</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78" x="876.5" y="62.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="883.5" y="83.334">IdP Proxy</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78" x="876.5" y="1405.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="883.5" y="1425.7754">IdP Proxy</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131" x="1121" y="62.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1128" y="83.334">Discovery Service</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="131" x="1121" y="1405.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1128" y="1425.7754">Discovery Service</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="35" x="1262" y="62.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="1269" y="83.334">IdP</text><rect fill="#FFA07A" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="35" x="1262" y="1405.2402"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="1269" y="1425.7754">IdP</text><rect fill="#FFFFFF" height="1178.7109" style="stroke:#181818;stroke-width:1.0;" width="10" x="563.5" y="199.5293"/><rect fill="#FFFFFF" height="733.7529" style="stroke:#181818;stroke-width:1.0;" width="10" x="910.5" y="341.7373"/><rect fill="#FFFFFF" height="87.9316" style="stroke:#181818;stroke-width:1.0;" width="10" x="1181.5" y="453.3242"/><rect fill="#FFFFFF" height="346.3711" style="stroke:#181818;stroke-width:1.0;" width="10" x="1274.5" y="656.1875"/><polygon fill="#181818" points="143.5,136.9082,153.5,140.9082,143.5,144.9082,147.5,140.9082" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53.5" x2="149.5" y1="140.9082" y2="140.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="60.5" y="120.8555">go wiki.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="60.5" y="136.166">research.org</text><polygon fill="#181818" points="166.5,166.2188,156.5,170.2188,166.5,174.2188,162.5,170.2188" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="252.5,166.2188,262.5,170.2188,252.5,174.2188,256.5,170.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="258.5" y1="170.2188" y2="170.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="172.5" y="165.4766">response 302</text><polygon fill="#181818" points="551.5,195.5293,561.5,199.5293,551.5,203.5293,555.5,199.5293" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="557.5" y1="199.5293" y2="199.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="162.5" y="194.7871">GET RP</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="573.5" x2="615.5" y1="259.4609" y2="259.4609"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="615.5" x2="615.5" y1="259.4609" y2="272.4609"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="574.5" x2="615.5" y1="272.4609" y2="272.4609"/><polygon fill="#181818" points="584.5,268.4609,574.5,272.4609,584.5,276.4609,580.5,272.4609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="580.5" y="224.0977">No active</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="580.5" y="239.4082">SSO state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="580.5" y="254.7188">found</text><polygon fill="#181818" points="166.5,297.7715,156.5,301.7715,166.5,305.7715,162.5,301.7715" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="562.5" y1="301.7715" y2="301.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="172.5" y="297.0293">302 to IdP Proxy w/ SAML2</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="346.5" y="296.7056">&lt;samlp:AuthnRequest&gt;</text><polygon fill="#181818" points="898.5,337.7373,908.5,341.7373,898.5,345.7373,902.5,341.7373" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="904.5" y1="341.7373" y2="341.7373"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="162.5" y="336.9951">SAML2</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="208.5" y="336.6714">&lt;samlp:AuthnRequest&gt;</text><path d="M925,314.7715 L925,354.7715 L1416,354.7715 L1416,324.7715 L1406,314.7715 L925,314.7715 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1406,314.7715 L1406,324.7715 L1416,324.7715 L1406,314.7715 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="931" y="332.3398">Assumes use of SAML2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="100" x="1081" y="332.3398">HTTP-Redirect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1185" y="332.3398">binding.</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="1241" y="332.0161">&lt;samlp:AuthnRequest&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="931" y="347.6504">could also be delivered via</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="79" x="1102" y="347.6504">HTTP-POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1185" y="347.6504">binding.</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="920.5" x2="962.5" y1="381.7031" y2="381.7031"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="962.5" x2="962.5" y1="381.7031" y2="394.7031"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="921.5" x2="962.5" y1="394.7031" y2="394.7031"/><polygon fill="#181818" points="931.5,390.7031,921.5,394.7031,931.5,398.7031,927.5,394.7031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="927.5" y="376.9609">validate</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="980.5" y="376.6372">&lt;samlp:AuthnRequest&gt;</text><polygon fill="#181818" points="166.5,420.0137,156.5,424.0137,166.5,428.0137,162.5,424.0137" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="909.5" y1="424.0137" y2="424.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="172.5" y="419.2715">302 redirect to Discovery Service</text><polygon fill="#181818" points="1169.5,449.3242,1179.5,453.3242,1169.5,457.3242,1173.5,453.3242" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="1175.5" y1="453.3242" y2="453.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="162.5" y="448.582">GET DISCO</text><polygon fill="#181818" points="64.5,478.6348,54.5,482.6348,64.5,486.6348,60.5,482.6348" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="1180.5" y1="482.6348" y2="482.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="70.5" y="477.8926">list of IdP options presented to user</text><polygon fill="#181818" points="1169.5,507.9453,1179.5,511.9453,1169.5,515.9453,1173.5,511.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53.5" x2="1175.5" y1="511.9453" y2="511.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="60.5" y="507.2031">IdP selected</text><polygon fill="#181818" points="166.5,537.2559,156.5,541.2559,166.5,545.2559,162.5,541.2559" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="1185.5" y1="541.2559" y2="541.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="172.5" y="536.5137">302 redirect to IdP Proxy with IdP selection</text><line style="stroke:#A80036;stroke-width:2.0;" x1="1177.5" x2="1195.5" y1="532.2559" y2="550.2559"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1177.5" x2="1195.5" y1="550.2559" y2="532.2559"/><polygon fill="#181818" points="898.5,551.2559,908.5,555.2559,898.5,559.2559,902.5,555.2559" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="904.5" y1="555.2559" y2="555.2559"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="920.5" x2="962.5" y1="599.877" y2="599.877"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="962.5" x2="962.5" y1="599.877" y2="612.877"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="921.5" x2="962.5" y1="612.877" y2="612.877"/><polygon fill="#181818" points="931.5,608.877,921.5,612.877,931.5,616.877,927.5,612.877" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="927.5" y="579.8242">generate new</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="1014.5" y="579.5005">&lt;samlp:AuthnRequest&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="927.5" y="595.1348">from user's IdP selection</text><polygon fill="#181818" points="166.5,638.1875,156.5,642.1875,166.5,646.1875,162.5,642.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="909.5" y1="642.1875" y2="642.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="172.5" y="637.4453">302 redirect to selected IdP with</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="160" x="379.5" y="637.1216">&lt;samlp:AuthnRequest&gt;</text><polygon fill="#181818" points="1262.5,652.1875,1272.5,656.1875,1262.5,660.1875,1266.5,656.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="1268.5" y1="656.1875" y2="656.1875"/><path d="M10,671.1875 L72,671.1875 L72,678.498 L62,688.498 L10,688.498 L10,671.1875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="324.3711" style="stroke:#000000;stroke-width:1.5;" width="1558.5" x="10" y="671.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="684.7559">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="263" x="87" y="683.8223">[Assume existing SSO state at IdP that satisfies</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="210" x="354" y="683.5483">&lt;samlp:RequestedAuthnContext&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="564" y="683.8223">]</text><polygon fill="#181818" points="166.5,731.7744,156.5,735.7744,166.5,739.7744,162.5,735.7744" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="1273.5" y1="735.7744" y2="735.7744"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="172.5" y="715.7217">send SAML2</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="252.5" y="715.3979">&lt;samlp:Response&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="384.5" y="715.7217">to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="172.5" y="731.0322">IdP Proxy via HTTP-POST binding</text><path d="M1289,693.498 L1289,748.498 L1558,748.498 L1558,703.498 L1548,693.498 L1289,693.498 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1548,693.498 L1548,703.498 L1558,703.498 L1548,693.498 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="1295" y="710.7427">&lt;samlp:Response&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="1427" y="711.0664">could be sent over</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="1295" y="726.377">different binding; HTTP-POST is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="1295" y="741.6875">most common.</text><polygon fill="#181818" points="898.5,756.4297,908.5,760.4297,898.5,764.4297,902.5,760.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="904.5" y1="760.4297" y2="760.4297"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1568.5" y1="769.4297" y2="769.4297"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="209" x="15" y="780.0645">[Assume no existing SSO state at IdP]</text><path d="M20,790.3848 L94,790.3848 L94,797.6953 L84,807.6953 L20,807.6953 L20,790.3848 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="118.2422" style="stroke:#000000;stroke-width:1.5;" width="1427.5" x="20" y="790.3848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="35" y="803.9531">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="256" x="109" y="803.0195">[until AuthN success, could also require MFA]</text><polygon fill="#181818" points="64.5,825.0059,54.5,829.0059,64.5,833.0059,60.5,829.0059" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58.5" x2="1273.5" y1="829.0059" y2="829.0059"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="70.5" y="824.2637">prompt user to authenticate</text><polygon fill="#181818" points="1262.5,854.3164,1272.5,858.3164,1262.5,862.3164,1266.5,858.3164" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53.5" x2="1268.5" y1="858.3164" y2="858.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="60.5" y="853.5742">user performs authentication action</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1284.5" x2="1326.5" y1="887.627" y2="887.627"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1326.5" x2="1326.5" y1="887.627" y2="900.627"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1285.5" x2="1326.5" y1="900.627" y2="900.627"/><polygon fill="#181818" points="1295.5,896.627,1285.5,900.627,1295.5,904.627,1291.5,900.627" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="1291.5" y="882.8848">validate authentication</text><polygon fill="#181818" points="166.5,958.9033,156.5,962.9033,166.5,966.9033,162.5,962.9033" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="1273.5" y1="962.9033" y2="962.9033"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="172.5" y="942.8506">set IdP SSO session cookie and send SAML2</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="172.5" y="957.8374">&lt;samlp:Response&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="304.5" y="958.1611">to IdP Proxy via HTTP-POST binding</text><path d="M1289,920.627 L1289,975.627 L1558,975.627 L1558,930.627 L1548,920.627 L1289,920.627 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1548,920.627 L1548,930.627 L1558,930.627 L1548,920.627 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="1295" y="937.8716">&lt;samlp:Response&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="1427" y="938.1953">could be sent over</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="1295" y="953.5059">different binding; HTTP-POST is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="1295" y="968.8164">most common.</text><polygon fill="#181818" points="898.5,983.5586,908.5,987.5586,898.5,991.5586,902.5,987.5586" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="904.5" y1="987.5586" y2="987.5586"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1270.5" x2="1288.5" y1="1002.5586" y2="1020.5586"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1270.5" x2="1288.5" y1="1020.5586" y2="1002.5586"/><polygon fill="#181818" points="166.5,1071.4902,156.5,1075.4902,166.5,1079.4902,162.5,1075.4902" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="914.5" y1="1075.4902" y2="1075.4902"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="172.5" y="1040.127">set IdP Proxy SSO session cookie and send</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="172.5" y="1055.4375">SAML</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="210.5" y="1055.1138">&lt;samlp:Response&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="342.5" y="1055.4375">to nRP ACS endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="172.5" y="1070.748">via HTTP-POST binding</text><path d="M925,1025.5586 L925,1080.5586 L1194,1080.5586 L1194,1035.5586 L1184,1025.5586 L925,1025.5586 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1184,1025.5586 L1184,1035.5586 L1194,1035.5586 L1184,1025.5586 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="931" y="1042.8032">&lt;samlp:Response&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="1063" y="1043.127">could be sent over</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="931" y="1058.4375">different binding; HTTP-POST is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="931" y="1073.748">most common.</text><line style="stroke:#A80036;stroke-width:2.0;" x1="906.5" x2="924.5" y1="1066.4902" y2="1084.4902"/><line style="stroke:#A80036;stroke-width:2.0;" x1="906.5" x2="924.5" y1="1084.4902" y2="1066.4902"/><polygon fill="#181818" points="551.5,1088.4902,561.5,1092.4902,551.5,1096.4902,555.5,1092.4902" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="557.5" y1="1092.4902" y2="1092.4902"/><line style="stroke:#181818;stroke-width:1.0;" x1="573.5" x2="615.5" y1="1137.1113" y2="1137.1113"/><line style="stroke:#181818;stroke-width:1.0;" x1="615.5" x2="615.5" y1="1137.1113" y2="1150.1113"/><line style="stroke:#181818;stroke-width:1.0;" x1="574.5" x2="615.5" y1="1150.1113" y2="1150.1113"/><polygon fill="#181818" points="584.5,1146.1113,574.5,1150.1113,584.5,1154.1113,580.5,1150.1113" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="580.5" y="1117.0586">validate</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="633.5" y="1116.7349">&lt;samlp:Response&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="765.5" y="1117.0586">and inspect attributes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="580.5" y="1132.3691">in</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="596.5" y="1132.0454">&lt;saml:Assertion&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="728.5" y="1132.3691">to make authZ decision</text><path d="M61,1165.1113 L123,1165.1113 L123,1172.4219 L113,1182.4219 L61,1182.4219 L61,1165.1113 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="206.1289" style="stroke:#000000;stroke-width:1.5;" width="533" x="61" y="1165.1113"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="76" y="1178.6797">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="93" x="138" y="1177.7461">[Access allowed]</text><polygon fill="#181818" points="166.5,1199.7324,156.5,1203.7324,166.5,1207.7324,162.5,1203.7324" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="562.5" y1="1203.7324" y2="1203.7324"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="384" x="172.5" y="1198.9902">Set RP SSO session cookie and redirect user to original target</text><polygon fill="#181818" points="252.5,1229.043,262.5,1233.043,252.5,1237.043,256.5,1233.043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="155.5" x2="258.5" y1="1233.043" y2="1233.043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="162.5" y="1228.3008">302 redirect</text><path d="M160,1246.043 L160,1271.043 L368,1271.043 L368,1256.043 L358,1246.043 L160,1246.043 " fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><path d="M358,1246.043 L358,1256.043 L368,1256.043 L358,1246.043 " fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="166" y="1263.6113">&#128578; Yay, we accessed the wiki!</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61" x2="594" y1="1277.3535" y2="1277.3535"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="89" x="66" y="1287.9883">[Access Denied]</text><polygon fill="#181818" points="166.5,1308.6191,156.5,1312.6191,166.5,1316.6191,162.5,1312.6191" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="562.5" y1="1312.6191" y2="1312.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="172.5" y="1307.877">return failure response</text><path d="M71,1325.6191 L71,1365.6191 L240,1365.6191 L240,1335.6191 L230,1325.6191 L71,1325.6191 " fill="#F08080" style="stroke:#181818;stroke-width:0.5;"/><path d="M230,1325.6191 L230,1335.6191 L240,1335.6191 L230,1325.6191 " fill="#F08080" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="77" y="1343.1875">&#128577; Boo, we were denied</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="77" y="1358.498">access to the wiki!</text><line style="stroke:#A80036;stroke-width:2.0;" x1="559.5" x2="577.5" y1="1378.2402" y2="1396.2402"/><line style="stroke:#A80036;stroke-width:2.0;" x1="559.5" x2="577.5" y1="1396.2402" y2="1378.2402"/><!--MD5=[6acd123383141f242e292fe83167ad54]
@startuml samlProxyDiscoveryDetailSeq

title Basic SAMLv2 Proxy Flow (including discovery)

box User #LightGray
    participant Alice #LightSalmon
    participant Browser #LightSalmon
end box

box research.org #LightCyan
    participant Wiki #LightSalmon
    participant RP #LightSalmon
end box

participant "IdP Proxy" as proxy #LightSalmon
participant "Discovery Service" as disco #LightSalmon
participant "IdP" as idp #LightSalmon

Alice - -> Browser: go wiki.\nresearch.org
Browser <-> Wiki: response 302 
Browser -> RP: GET RP
activate RP
RP - -> RP: No active\nSSO state\nfound
RP -> Browser: 302 to IdP Proxy w/ SAML2 ""<samlp:AuthnRequest>""
Browser -> proxy: SAML2 ""<samlp:AuthnRequest>"" 
note right
    Assumes use of SAML2 **HTTP-Redirect** binding. ""<samlp:AuthnRequest>""
    could also be delivered via **HTTP-POST** binding.
end note
activate proxy
proxy - -> proxy: validate ""<samlp:AuthnRequest>""
proxy -> Browser: 302 redirect to Discovery Service
Browser -> disco: GET DISCO
activate disco
disco - -> Alice: list of IdP options presented to user
Alice - -> disco: IdP selected
disco -> Browser: 302 redirect to IdP Proxy with IdP selection
destroy disco
Browser -> proxy
proxy - -> proxy: generate new ""<samlp:AuthnRequest>""\nfrom user's IdP selection
proxy -> Browser: 302 redirect to selected IdP with ""<samlp:AuthnRequest>""
Browser -> idp
activate idp
alt Assume existing SSO state at IdP that satisfies ""<samlp:RequestedAuthnContext>>""
    idp -> Browser: send SAML2 ""<samlp:Response>"" to\nIdP Proxy via HTTP-POST binding
    note right
        ""<samlp:Response>"" could be sent over
        different binding; HTTP-POST is
        most common. 
    end note
    Browser -> proxy
else Assume no existing SSO state at IdP
    loop until AuthN success, could also require MFA
        idp - -> Alice: prompt user to authenticate
        Alice - -> idp: user performs authentication action
        idp - -> idp: validate authentication 
    end
    idp -> Browser: set IdP SSO session cookie and send SAML2\n""<samlp:Response>"" to IdP Proxy via HTTP-POST binding
    note right
        ""<samlp:Response>"" could be sent over
        different binding; HTTP-POST is
        most common. 
    end note
    Browser -> proxy
end
destroy idp
proxy -> Browser: set IdP Proxy SSO session cookie and send\nSAML ""<samlp:Response>"" to nRP ACS endpoint\nvia HTTP-POST binding
note right
    ""<samlp:Response>"" could be sent over
    different binding; HTTP-POST is
    most common. 
end note
destroy proxy
Browser -> RP
RP -> RP: validate ""<samlp:Response>"" and inspect attributes\nin ""<saml:Assertion>"" to make authZ decision
alt Access allowed
    RP -> Browser: Set RP SSO session cookie and redirect user to original target
    Browser -> Wiki: 302 redirect
    note over Wiki #LightGreen
        🙂 Yay, we accessed the wiki!
    end note
else Access Denied
    RP -> Browser: return failure response
    note over Browser #LightCoral
        🙁 Boo, we were denied
        access to the wiki!
    end note
end
destroy RP

@enduml

PlantUML version 1.2022.7(Mon Aug 22 10:01:30 MST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>